var Booby=new function(){function y(){function e(e){if(e==null){e=window.event}if(e==null){return null}if(e.type=="touchstart"||e.type=="touchmove"){e=e.originalEvent.touches[0]}if(e.pageX||e.pageY){return{x:e.pageX/o,y:e.pageY/o}}return null}window.addEventListener("resize",E,false);$("#booby").click(function(e){E()});$("#nav-home").click(function(e){$("#signature").fadeOut(function(){$("#donate").fadeIn()});$("#nav").removeClass("invert");m=false;b();E();return false});$("#nav-about").click(function(e){$("#donate").fadeOut(function(){$("#signature").fadeIn()});$("#nav").addClass("invert");m=true;E();return false});document.onkeydown=function(e){var t;if(e==null){t=window.event.keyCode}else{t=e.keyCode}switch(t){case 37:u.addForce(new x(-50,0));break;case 38:u.addForce(new x(0,-50));break;case 39:u.addForce(new x(50,0));break;case 40:u.addForce(new x(0,50));break;case 74:u.join();break;case 72:u.split();break;case 71:toggleGravity();break;default:break}};$("#booby").on("mousedown touchstart",function(t){t.preventDefault();var n;if(f==true){return}n=e(t);if(n==null){return}c=u.selectBlob(n.x,n.y);if(c==null&&t.type=="mousedown"){o+=20;g.play()}});$("#booby").on("gesturestart gestureend",function(e){e.preventDefault()});$("#booby").on("gesturechange",function(e){e.preventDefault();if(e.originalEvent.scale<1){o-=1}else{o+=1}clearTimeout(this.id);this.id=setTimeout(E,100)});$("#booby").on("mouseup touchend",function(e){e.preventDefault();u.unselectBlob();l=null;c=null});$("#booby").on("mousemove touchmove",function(t){t.preventDefault();var n;if(f==true){return}if(c==null){return}n=e(t);if(n==null){return}u.selectedBlobMoveTo(n.x-c.x,n.y-c.y);l=n})}function b(){if(window.innerWidth>1200){o=500}else if(window.innerWidth>640){o=350}else{o=200}}function E(){t.width=$(window).width();t.height=$(window).height();n.width=t.width;n.height=t.height;n.style.position="absolute";n.style.left=0;n.style.top=0;if(m){r.fillStyle="#f1a8a9"}else{r.fillStyle="#322d7a"}r.fillRect(0,0,t.width,t.height);s.setEnvironment()}function S(){img=new Image;img.src=e+"/images/boing1.png";p={img:img,sound:new Audio(e+"/audio/boing.mp3"),pos:{x:null,y:null},vel:{x:8,y:8}};img=new Image;img.src=e+"/images/boing2.png";d={img:img,sound:new Audio(e+"/audio/boing.mp3"),pos:{x:null,y:null},vel:{x:10,y:10}};img=new Image;img.src=e+"/images/boing3.png";v={img:img,sound:new Audio(e+"/audio/boing.mp3"),pos:{x:null,y:null},vel:{x:12,y:12}}}function x(e,t){this.x=e;this.y=t;this.equal=function(e){return this.x==e.getX()&&this.y==e.getY()};this.getX=function(){return this.x};this.getY=function(){return this.y};this.setX=function(e){this.x=e};this.setY=function(e){this.y=e};this.addX=function(e){this.x+=e};this.addY=function(e){this.y+=e};this.set=function(e){this.x=e.getX();this.y=e.getY()};this.add=function(e){this.x+=e.getX();this.y+=e.getY()};this.sub=function(e){this.x-=e.getX();this.y-=e.getY()};this.dotProd=function(e){return this.x*e.getX()+this.y*e.getY()};this.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};this.scale=function(e){this.x*=e;this.y*=e};this.toString=function(){return" X: "+this.x+" Y: "+this.y}}function T(){this.setEnvironment=function(){this.left=t.x;this.right=t.x+t.width/o;this.top=t.y;this.bottom=t.y+(t.height-100)/o;this.r=new x(0,0)};this.collision=function(e,t){var n=false;var r;if(e.getX()<this.left){e.setX(this.left);n=true;g.play();u.unselectBlob()}else if(e.getX()>this.right){e.setX(this.right);n=true;g.play();u.unselectBlob()}if(e.getY()<this.top){e.setY(this.top);n=true;g.play();u.unselectBlob()}else if(e.getY()>this.bottom){e.setY(this.bottom);n=true}return n}}function N(e,t,n){this.cur=new x(e,t);this.prev=new x(e,t);this.mass=n;this.force=new x(0,0);this.result=new x(0,0);this.friction=.01;this.getXPos=function(){return this.cur.getX()};this.getYPos=function(){return this.cur.getY()};this.getPos=function(){return this.cur};this.getXPrevPos=function(){return this.prev.getX()};this.getYPrevPos=function(){return this.prev.getY()};this.getPrevPos=function(){return this.prev};this.addXPos=function(e){this.cur.addX(e)};this.addYPos=function(e){this.cur.addY(e)};this.setForce=function(e){this.force.set(e)};this.addForce=function(e){this.force.add(e)};this.getMass=function(){return this.mass};this.setMass=function(e){this.mass=e};this.move=function(e){var t,n,r,i;i=e*e;n=this.force.getX()/this.mass;r=this.cur.getX();t=(2-this.friction)*r-(1-this.friction)*this.prev.getX()+n*i;this.prev.setX(r);this.cur.setX(t);n=this.force.getY()/this.mass;r=this.cur.getY();t=(2-this.friction)*r-(1-this.friction)*this.prev.getY()+n*i;this.prev.setY(r);this.cur.setY(t)};this.setFriction=function(e){this.friction=e};this.getVelocity=function(){var e,t;e=this.cur.getX()-this.prev.getX();t=this.cur.getY()-this.prev.getY();return e*e+t*t};this.draw=function(e,t){e.lineWidth=2;e.fillStyle="#000000";e.strokeStyle="#000000";e.beginPath();e.arc(this.cur.getX()*t,this.cur.getY()*t,4,0,Math.PI*2,true);e.fill()}}function C(e,t,n,r){this.pointMass=e;this.y=t;this.delta=new x(0,0);this.shortConst=n;this.longConst=r;this.sc=function(){var t;t=Math.abs(this.pointMass.getYPos()-this.y);this.delta.setY(-t);if(this.shortConst!=0&&t<this.shortConst){var n;n=this.shortConst/t;this.delta.scale(n);e.getPos().sub(this.delta)}else if(this.longConst!=0&&t>this.longConst){var n;n=this.longConst/t;this.delta.scale(n);e.getPos().sub(this.delta)}}}function k(e,t,n,r){this.pointMassA=e;this.pointMassB=t;this.delta=new x(0,0);this.pointMassAPos=e.getPos();this.pointMassBPos=t.getPos();this.delta.set(this.pointMassBPos);this.delta.sub(this.pointMassAPos);this.shortConst=this.delta.length()*n;this.longConst=this.delta.length()*r;this.scSquared=this.shortConst*this.shortConst;this.lcSquared=this.longConst*this.longConst;this.setDist=function(e,t){this.shortConst=e;this.longConst=t;this.scSquared=this.shortConst*this.shortConst;this.lcSquared=this.longConst*this.longConst};this.scale=function(e){this.shortConst=this.shortConst*e;this.longConst=this.longConst*e;this.scSquared=this.shortConst*this.shortConst;this.lcSquared=this.longConst*this.longConst};this.sc=function(){this.delta.set(this.pointMassBPos);this.delta.sub(this.pointMassAPos);var e=this.delta.dotProd(this.delta);if(this.shortConst!=0&&e<this.scSquared){var t;t=this.scSquared/(e+this.scSquared)-.5;this.delta.scale(t);this.pointMassAPos.sub(this.delta);this.pointMassBPos.add(this.delta)}else if(this.longConst!=0&&e>this.lcSquared){var t;t=this.lcSquared/(e+this.lcSquared)-.5;this.delta.scale(t);this.pointMassAPos.sub(this.delta);this.pointMassBPos.add(this.delta)}}}function L(e,t){function n(e,t){var n,r;n=e.getXPos()-t.getXPos();r=e.getYPos()-t.getYPos();return Math.sqrt(n*n+r*r)}this.length=n(e,t);this.lengthSquared=this.length*this.length;this.pointMassA=e;this.pointMassB=t;this.delta=new x(0,0);this.getPointMassA=function(){return this.pointMassA};this.getPointMassB=function(){return this.pointMassB};this.scale=function(e){this.length*=e;this.lengthSquared=this.length*this.length};this.sc=function(e){var t,n;var r,i;r=this.pointMassA.getPos();i=this.pointMassB.getPos();this.delta.set(i);this.delta.sub(r);t=this.delta.dotProd(this.delta);n=this.lengthSquared/(t+this.lengthSquared)-.5;this.delta.scale(n);r.sub(this.delta);i.add(this.delta)};this.setForce=function(e){this.pointMassA.setForce(e);this.pointMassB.setForce(e)};this.addForce=function(e){this.pointMassA.addForce(e);this.pointMassB.addForce(e)};this.move=function(e){this.pointMassA.move(e);this.pointMassB.move(e)};this.draw=function(e,t){this.pointMassA.draw(e,t);this.pointMassB.draw(e,t);e.lineWidth=3;e.fillStyle="#000000";e.strokeStyle="#000000";e.beginPath();e.moveTo(this.pointMassA.getXPos()*t,this.pointMassA.getYPos()*t);e.lineTo(this.pointMassB.getXPos()*t,this.pointMassB.getYPos()*t);e.stroke()}}function A(e,t,n,r,i){this.restLength=e;this.stiffness=t;this.damper=n;this.pointMassA=r;this.pointMassB=i;this.tmp=x(0,0);this.move=function(e){var t;var n;var r;var i;t=this.pointMassA.getXPos()-this.pointMassB.getXPos();n=this.pointMassA.getYPos()-this.pointMassB.getYPos();i=Math.sqrt(t*t+n*n);r=this.stiffness*(i/this.restLength-1);var s;var o;var u;s=this.pointMassA.getXVel()-this.pointMassB.getXVel();o=this.pointMassA.getYVel()-this.pointMassB.getYVel();u=s*t+o*n;u*=this.damper;var a;var f;a=(r+u)*t;f=(r+u)*n;this.tmp.setX(-a);this.tmp.setY(-ft);this.pointMassA.addForce(this.tmp);this.tmp.setX(a);this.tmp.setY(ft);this.pointMassB.addForce(this.tmp);this.pointMassA.move(e);this.pointMassB.move(e)};this.addForce=function(e){this.pointMassA.addForce(e);this.pointMassB.addForce(e)};this.draw=function(e,t){this.pointMassA.draw(e,t);this.pointMassB.draw(e,t);e.fillStyle="#000000";e.strokeStyle="#000000";e.beginPath();e.moveTo(this.pointMassA.getXPos()*t,this.pointMassA.getYPos()*t);e.lineTo(this.pointMassB.getXPos()*t,this.pointMassB.getXPos()*t);e.stroke()}}function O(e,s,u,a){function S(e,t){e+=t;return e%t}this.x=e;this.y=s;this.sticks=new Array;this.pointMasses=new Array;this.joints=new Array;this.middlePointMass;this.radius=u;this.selected=false;a=8;var f=.1;var l=.95,c=1.05;var y,b,E;for(b=0,y=0;b<a;b++){this.pointMasses[b]=new N(Math.cos(y)*u+e,Math.sin(y)*u+s,1);y+=2*Math.PI/a}this.middlePointMass=new N(e,s,1);this.pointMasses[0].setMass(4);this.pointMasses[1].setMass(4);for(b=0;b<a;b++){this.sticks[b]=new L(this.pointMasses[b],this.pointMasses[S(b+1,a)])}for(b=0,E=0;b<a;b++){this.joints[E++]=new k(this.pointMasses[b],this.pointMasses[S(b+a/2+1,a)],l,c);this.joints[E++]=new k(this.pointMasses[b],this.middlePointMass,c*.9,l*1.05)}this.addBlob=function(e){var t=this.joints.length;var n;this.joints[t]=new k(this.middlePointMass,e.getMiddlePointMass(),0,0);n=this.radius+e.getRadius();this.joints[t].setDist(n*.95,0)};this.getMiddlePointMass=function(){return this.middlePointMass};this.getRadius=function(){return this.radius};this.getXPos=function(){return this.middlePointMass.getXPos()};this.getYPos=function(){return this.middlePointMass.getYPos()};this.scale=function(e){var t;for(t=0;t<this.joints.length;t++){this.joints[t].scale(e)}for(t=0;t<this.sticks.length;t++){this.sticks[t].scale(e)}this.radius*=e};this.move=function(e){var t;for(t=0;t<this.pointMasses.length;t++){this.pointMasses[t].move(e)}this.middlePointMass.move(e)};this.sc=function(e){var t,n;for(n=0;n<4;n++){for(t=0;t<this.pointMasses.length;t++){if(e.collision(this.pointMasses[t].getPos(),this.pointMasses[t].getPrevPos())==true){this.pointMasses[t].setFriction(.75)}else{this.pointMasses[t].setFriction(.01)}}for(t=0;t<this.sticks.length;t++){this.sticks[t].sc(e)}for(t=0;t<this.joints.length;t++){this.joints[t].sc()}}};this.setForce=function(e){var t;for(t=0;t<this.pointMasses.length;t++){this.pointMasses[t].setForce(e)}this.middlePointMass.setForce(e)};this.addForce=function(e){var t;for(t=0;t<this.pointMasses.length;t++){this.pointMasses[t].addForce(e)}this.middlePointMass.addForce(e);this.pointMasses[0].addForce(e);this.pointMasses[0].addForce(e);this.pointMasses[0].addForce(e);this.pointMasses[0].addForce(e)};this.moveTo=function(e,t){var n,r;r=this.middlePointMass.getPos();e-=r.getX(e);t-=r.getY(t);for(n=0;n<this.pointMasses.length;n++){r=this.pointMasses[n].getPos();r.addX(e);r.addY(t)}r=this.middlePointMass.getPos();r.addX(e);r.addY(t)};this.setSelected=function(e){this.selected=e};this.getPointMass=function(e){e+=this.pointMasses.length;e=e%this.pointMasses.length;return this.pointMasses[e]};this.drawBody=function(e,t){var n;e.strokeStyle="#f1a8a9";e.fillStyle="#f1a8a9";e.lineWidth=0;e.beginPath();e.moveTo(this.pointMasses[0].getXPos()*t,this.pointMasses[0].getYPos()*t);for(n=0;n<this.pointMasses.length;n++){var r,i,s,o,u,a,f,l;var c,h,p,d;c=this.getPointMass(n-1);h=this.pointMasses[n];p=this.getPointMass(n+1);d=this.getPointMass(n+2);u=p.getXPos();a=p.getYPos();f=h.getXPos();l=h.getYPos();r=f*.5+u*.5;i=l*.5+a*.5;s=f-c.getXPos()+u-d.getXPos();o=l-c.getYPos()+a-d.getYPos();r+=s*.16;i+=o*.16;r=r*t;i=i*t;u=u*t;a=a*t;e.bezierCurveTo(r,i,u,a,u,a)}e.closePath();e.stroke();e.fill()};this.drawShadow=function(){cy=t.height-80;w=i*2*o;cx=this.middlePointMass.getXPos()*o-w/2;h=50*this.middlePointMass.getYPos();if(h<0){h=0}H(cx,cy,w,h,"rgba(0,0,0, 0.2)")};this.drawNipple=function(e,t){e.lineWidth=1;e.strokeStyle="#EF96A0";e.fillStyle="#EF96A0";e.beginPath();e.arc(0,0,this.radius*.4*t,0,2*Math.PI,false);e.fill();e.lineWidth=1;e.strokeStyle="#EC708E";e.fillStyle="#EC708E";e.beginPath();e.arc(0,0,this.radius*.14*t,0,2*Math.PI,false);e.fill()};this.drawBoing=function(e){img=e["img"];boingPos=e["pos"];boingVel=e["vel"];g=e["sound"];if($(window).width()>=768){imgHeight=img.height/2;imgWidth=img.width/2}else{imgHeight=img.height/4;imgWidth=img.width/4}if(boingPos.x==null){boingPos.x=$(window).width()-imgWidth/2}boingPos.x+=boingVel.x;if(boingPos.y==null){boingPos.y=$(window).height()-imgHeight/2}boingPos.y+=boingVel.y;if(boingPos.x<imgWidth||boingPos.x>=n.width){boingVel.x*=-1;g.play()}if(boingPos.y<imgHeight||boingPos.y>n.height){boingVel.y*=-1;g.play()}r.drawImage(img,boingPos.x-imgWidth,boingPos.y-imgHeight,imgWidth,imgHeight)};this.draw=function(e,t){var n;var r,i,s;if(!m){this.drawShadow();this.drawBody(e,t)}e.strokeStyle="#000000";e.fillStyle="#000000";e.save();if(m){e.translate($(window).width()/2,$(window).height()/2)}else{e.translate(this.middlePointMass.getXPos()*t,this.middlePointMass.getYPos()*t)}r=new x(0,-1);i=new x(0,0);i.set(this.pointMasses[0].getPos());i.sub(this.middlePointMass.getPos());s=Math.acos(i.dotProd(r)/i.length());if(i.getX()<0){e.rotate(-s)}else{e.rotate(s)}this.drawNipple(e,t);e.restore();if(m){this.drawBoing(p);this.drawBoing(d);this.drawBoing(v)}e.save();e.restore()}}function M(e,t,n,r){this.maxNum=r;this.numActive=1;this.blobs=new Array;this.tmpForce=new x(0,0);this.selectedBlob=null;this.blobs[0]=new O(e,t,i,8);this.findSmallest=function(e){var t=1e3,n;var r;for(r=0;r<this.blobs.length;r++){if(r==e||this.blobs[r]==null){continue}if(this.blobs[r].getRadius()<t){n=r;t=this.blobs[r].getRadius()}}return n};this.findClosest=function(e){var t=1e3,n,r,i,s;var o;var u,a;u=this.blobs[e].getMiddlePointMass();for(o=0;o<this.blobs.length;o++){if(o==e||this.blobs[o]==null){continue}a=this.blobs[o].getMiddlePointMass();i=u.getXPos()-a.getXPos();s=u.getYPos()-a.getYPos();r=i*i+s*s;if(r<t){t=r;n=o}}return n};this.join=function(){var e,t,n,r;var i,s,o;if(this.numActive==1){return}e=this.findSmallest(-1);t=this.findClosest(e);i=this.blobs[e].getRadius();s=this.blobs[t].getRadius();o=Math.sqrt(i*i+s*s);this.blobs[e]=null;this.blobs[t].scale(.945*o/s);this.numActive--};this.selectBlob=function(e,t){var n,r=1e4;var i;var s;var o=null;if(this.selectedBlob!=null){return}for(n=0;n<this.blobs.length;n++){if(this.blobs[n]==null){continue}i=this.blobs[n].getMiddlePointMass();aXbX=e-i.getXPos();aYbY=t-i.getYPos();dist=aXbX*aXbX+aYbY*aYbY;if(dist<r){r=dist;if(dist<this.blobs[n].getRadius()*.5){this.selectedBlob=this.blobs[n];o={x:aXbX,y:aYbY}}}}if(this.selectedBlob!=null){this.selectedBlob.setSelected(true)}return o};this.unselectBlob=function(){if(this.selectedBlob==null){return}this.selectedBlob.setSelected(false);this.selectedBlob=null};this.selectedBlobMoveTo=function(e,t){if(this.selectedBlob==null){return}this.selectedBlob.moveTo(e,t)};this.move=function(e){var t;for(t=0;t<this.blobs.length;t++){if(this.blobs[t]==null){continue}this.blobs[t].move(e)}};this.sc=function(e){var t;for(t=0;t<this.blobs.length;t++){if(this.blobs[t]==null){continue}this.blobs[t].sc(e)}if(this.blobAnchor!=null){this.blobAnchor.sc()}};this.setForce=function(e){var t;for(t=0;t<this.blobs.length;t++){if(this.blobs[t]==null){continue}if(this.blobs[t]==this.selectedBlob){this.blobs[t].setForce(new x(0,0));continue}this.blobs[t].setForce(e)}};this.addForce=function(e){var t;for(t=0;t<this.blobs.length;t++){if(this.blobs[t]==null){continue}if(this.blobs[t]==this.selectedBlob){continue}this.tmpForce.setX(e.getX()*(Math.random()*.75+.25));this.tmpForce.setY(e.getY()*(Math.random()*.75+.25));this.blobs[t].addForce(this.tmpForce)}};this.draw=function(e,t){var n;for(n=0;n<this.blobs.length;n++){if(this.blobs[n]==null){continue}this.blobs[n].draw(e,o)}}}function _(e,t,n){if(confirm(e)==true&&t!=null){t()}else if(n!=null){n()}}function D(){var e=.05;if(l!=null&&c!=null){u.selectedBlobMoveTo(l.x-c.x,l.y-c.y)}u.move(e);u.sc(s);u.setForce(a)}function P(){if(n.getContext==null){return}if(m){r.fillStyle="#f1a8a9"}else{r.fillStyle="#322d7a"}r.fillRect(t.x,t.y,t.width,t.height);u.draw(r,o)}function H(e,t,n,i,s){var o=.5522848,u=n/2*o,a=i/2*o,f=e+n,l=t+i,c=e+n/2,h=t+i/2;r.save();r.beginPath();r.moveTo(e,h);r.bezierCurveTo(e,h-a,c-u,t,c,t);r.bezierCurveTo(c+u,t,f,h-a,f,h);r.bezierCurveTo(f,h+a,c+u,l,c,l);r.bezierCurveTo(c-u,l,e,h+a,e,h);r.fillStyle=s;r.fill();r.restore()}var e="http://dijkstra.io/Booby/assets";var t={x:0,y:0,width:window.innerWidth,height:window.innerHeight};var n;var r;var i=.4;var s;var o=400;var u;var a;var f;var l=null;var c=null;var p;var d;var v;var m=false;var g=new Audio(e+"/audio/boing.mp3");this.init=function(){n=document.getElementById("booby");r=n.getContext("2d");y();b();s=new T;u=new M(t.width/2/o,0,1,200);a=new x(0,10);f=false;E();setTimeout(function(){g.play()},200);setTimeout(function(){$("#nav, #donate").fadeIn()},500);this.timeout();S()};this.timeout=function(){P();D();if(f==false){setTimeout("Booby.timeout()",30)}}};$(document).ready(function(){Booby.init()})
